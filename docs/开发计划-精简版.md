# 四子游戏开发计划（精简版）

<!-- Generated by Qoder AI (Model: claude-sonnet-4-5-20250929) - 2025-10-21
     Task: 1人AI辅助开发计划 -->

## 项目概况

- **团队**: 1人 + AI工具（Claude、Cursor等）
- **技术**: Flutter + Node.js
- **工期**: 10-12周
- **目标**: 成熟产品，非原型

---

## 开发阶段

### 第一阶段：核心游戏（Week 1-3）

#### Week 1: 基础框架
```bash
# 创建项目
flutter create foursquare_game
cd foursquare_game
```

**任务**:
- [ ] 数据模型 (Position, BoardState, Move)
- [ ] 游戏引擎框架 (GameEngine)
- [ ] 棋盘UI组件
- [ ] 基础手势识别

**验收**: 能显示棋盘和棋子，能识别点击

---

#### Week 2: 游戏逻辑
**任务**:
- [ ] 移动规则实现（四方向验证）
- [ ] 吃子规则实现（三子紧邻检测）
- [ ] 胜负判定
- [ ] 移动动画
- [ ] 吃子动画

**核心代码示例**:
```dart
// 吃子检测（关键）
Position? detectCapture(BoardState board, Position movedPiece) {
  final player = board.getPiece(movedPiece);
  final enemy = player == PieceType.black ? PieceType.white : PieceType.black;
  
  // 四个方向：上、下、左、右
  final directions = [
    Position(0, -1),  // 上
    Position(0, 1),   // 下
    Position(-1, 0),  // 左
    Position(1, 0),   // 右
  ];
  
  for (var dir in directions) {
    // 情况1: 移动的棋子在第一个位置
    // 检查模式: [移动] - [己方] - [敌方]
    var pos1 = movedPiece;
    var pos2 = Position(pos1.x + dir.x, pos1.y + dir.y);
    var pos3 = Position(pos2.x + dir.x, pos2.y + dir.y);
    
    if (board.isInBounds(pos2) && board.isInBounds(pos3)) {
      if (board.getPiece(pos1) == player &&
          board.getPiece(pos2) == player &&
          board.getPiece(pos3) == enemy) {
        return pos3;  // 吃掉pos3位置的敌方棋子
      }
    }
    
    // 情况2: 移动的棋子在第二个位置
    // 检查模式: [己方] - [移动] - [敌方]
    var pos0 = Position(pos1.x - dir.x, pos1.y - dir.y);
    pos2 = Position(pos1.x + dir.x, pos1.y + dir.y);
    
    if (board.isInBounds(pos0) && board.isInBounds(pos2)) {
      if (board.getPiece(pos0) == player &&
          board.getPiece(pos1) == player &&
          board.getPiece(pos2) == enemy) {
        return pos2;  // 吃掉pos2位置的敌方棋子
      }
    }
  }
  
  return null;  // 没有吃子
}

// 关键点：
// 1. 只检测移动的棋子
// 2. 必须是己-己-敌模式
// 3. 三子必须紧邻（连续）
// 4. 每次只返回一个被吃位置
```

**验收**: 游戏规则100%正确

---

#### Week 3: 体验优化
**任务**:
- [ ] 音效（select、move、capture、win/lose）
- [ ] 震动反馈
- [ ] 主菜单
- [ ] 设置页面
- [ ] 规则说明

**验收**: 单机对战完整可玩

---

### 第二阶段：人机对战（Week 4-5）

#### Week 4: AI实现
**两种AI**:

1. **普通AI** (规则AI)
```dart
// 随机选择合法移动，优先吃子
Move getBasicAIMove(BoardState board) {
  var moves = getAllValidMoves(board);
  var captureMoves = moves.where((m) => canCapture(m));
  return captureMoves.isNotEmpty 
    ? captureMoves.first 
    : moves[Random().nextInt(moves.length)];
}
```

2. **智能AI** (Minimax)
```dart
Move getSmartAIMove(BoardState board) {
  return minimax(board, depth: 4);
}
```

**验收**: 
- 普通AI能正常对战，偶尔会犯错
- 智能AI难度适中，响应<2秒

---

### 第三阶段：局域网对战（Week 6-7）

#### Week 6-7: P2P通信
**任务**:
- [ ] 设备发现 (mDNS)
- [ ] Socket连接
- [ ] 房间管理
- [ ] 移动同步
- [ ] 计时器同步

**验收**: 同WiFi下能正常对战

---

### 第四阶段：在线对战（Week 8-10）

#### 后端服务 (Node.js + Socket.IO)
```javascript
// server.js
io.on('connection', (socket) => {
  socket.on('move', (move) => {
    // 验证移动
    // 广播给对手
  });
});
```

**任务**:
- [ ] 用户系统（游客模式）
- [ ] 匹配系统
- [ ] 房间管理
- [ ] ELO评分
- [ ] 排行榜

**验收**: 在线匹配对战流畅

---

### 第五阶段：优化发布（Week 11-12）

**任务**:
- [ ] 性能优化（FPS 60）
- [ ] Android打包
- [ ] iOS打包（如有Mac）
- [ ] Web部署
- [ ] 应用商店上架

---

## 里程碑

| 周数 | 里程碑 | 交付物 |
|------|--------|--------|
| Week 3 | Alpha | 单机可玩 |
| Week 5 | Beta | 人机对战 |
| Week 7 | RC1 | 局域网对战 |
| Week 10 | RC2 | 在线对战 |
| Week 12 | Release | 正式发布 |

---

## AI工具使用建议

### 代码生成
```
提示词模板:
"使用Flutter实现四子游戏的移动规则验证，
规则：仅四方向，一次一格，不可跳跃。
请生成isValidMove函数。"
```

### 代码审查
```
提示词:
"审查这段吃子检测代码，
规则：必须形成己-己-敌三子紧邻，
且只有移动的棋子参与判定。"
```

### 调试帮助
```
提示词:
"这段代码在某些情况下会误判吃子，
请帮我找出问题。[粘贴代码]"
```

---

## 开发规范（最小化）

### Git提交
```
feat: 实现移动规则
fix: 修复吃子误判
docs: 更新规则说明
```

### 代码注释
```dart
/// 检测是否可以吃子
/// 返回: 被吃棋子位置，无则返回null
Position? detectCapture(Position movedPiece) {
  // 实现...
}
```

### 测试
```dart
test('横向吃子', () {
  // Given: ○ ─ 空 ─ ●
  // When: 白棋移动到中间
  // Then: 应该吃掉黑棋
});
```

---

## 常见问题

### Q1: Flutter学习曲线陡峭怎么办？
**A**: 使用AI工具生成代码框架，逐步学习。推荐资源：
- Flutter官方文档
- 使用Claude/Cursor生成代码
- YouTube教程

### Q2: 如何确保游戏规则正确？
**A**: 
1. 先编写测试用例
2. 每个规则都要有单元测试
3. 手工测试各种边界情况

### Q3: AI算法性能不够怎么办？
**A**:
1. 降低搜索深度（3-4层足够）
2. 使用Alpha-Beta剪枝
3. 添加简单的开局库

---

## 快速启动

### 今天就开始
```bash
# 1. 安装Flutter
flutter doctor

# 2. 创建项目
flutter create foursquare_game
cd foursquare_game

# 3. 运行测试
flutter run

# 4. 开始Week 1任务
# 创建 lib/models/position.dart
# 创建 lib/models/board_state.dart
```

### 本周目标
- [ ] 完成Week 1所有任务
- [ ] 每天提交代码
- [ ] 记录遇到的问题

---

## 资源链接

- [Flutter文档](https://flutter.dev)
- [Socket.IO文档](https://socket.io)
- [游戏规则确认](./游戏规则确认.md)
- [项目代码仓库](https://github.com/yourusername/foursquare)

---

**立即行动，边学边做！** 🚀
