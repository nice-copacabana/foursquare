# 应用元数据配置指南

<!-- Generated by Qoder AI (Model: claude-sonnet-4-5-20250929) - 2025-10-22 -->
<!-- Task: 应用元数据配置完整指南 -->

## 概述

本指南说明如何为四子游戏配置Android、iOS和Web平台的应用元数据，包括应用名称、包名、版本号、权限等。

## 前提条件检查

### 检查平台代码是否存在

```bash
# 检查是否存在平台代码目录
ls android/  # Android平台
ls ios/      # iOS平台
ls web/      # Web平台
```

### 如果平台代码不存在

如果上述目录不存在，需要先生成平台代码：

```bash
# 重新创建平台代码（保留现有lib代码）
flutter create --platforms=android,ios,web .

# 或者只添加特定平台
flutter create --platforms=android .
flutter create --platforms=ios .
flutter create --platforms=web .
```

**注意**：执行`flutter create`会覆盖现有的平台配置文件，请先备份任何自定义修改。

## Android元数据配置

### 应用基本信息

**文件路径**: `android/app/build.gradle`

```gradle
android {
    namespace "com.qoder.foursquare"
    compileSdkVersion 34
    
    defaultConfig {
        // 应用唯一标识符
        applicationId "com.qoder.foursquare"
        
        // 最低支持版本
        minSdkVersion 21  // Android 5.0
        
        // 目标版本
        targetSdkVersion 34  // Android 14
        
        // 版本号（整数，每次发布递增）
        versionCode 1
        
        // 版本名称（显示给用户）
        versionName "1.0.0"
    }
    
    buildTypes {
        release {
            // 签名配置
            signingConfig signingConfigs.release
            
            // 代码混淆
            minifyEnabled true
            shrinkResources true
            
            // ProGuard规则
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
}
```

### 应用清单配置

**文件路径**: `android/app/src/main/AndroidManifest.xml`

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.qoder.foursquare">
    
    <!-- 权限声明 -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.VIBRATE" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    
    <application
        android:label="四子游戏"
        android:name="${applicationName}"
        android:icon="@mipmap/ic_launcher"
        android:enableOnBackInvokedCallback="true">
        
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTop"
            android:theme="@style/LaunchTheme"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
            android:hardwareAccelerated="true"
            android:windowSoftInputMode="adjustResize">
            
            <!-- 设置为主Activity -->
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
            
            <!-- Deep Link支持（可选） -->
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                <data
                    android:scheme="foursquare"
                    android:host="game" />
            </intent-filter>
        </activity>
        
        <!-- 不要删除 Flutter 所需的meta-data -->
        <meta-data
            android:name="flutterEmbedding"
            android:value="2" />
    </application>
</manifest>
```

### 权限说明

| 权限 | 用途 | 必需性 | 用户可见说明 |
|------|------|--------|-------------|
| INTERNET | 在线对战、数据分析（未来功能） | 推荐 | "用于在线对战和应用更新" |
| VIBRATE | 触觉反馈 | 可选 | "用于游戏操作震动反馈" |
| ACCESS_NETWORK_STATE | 网络状态检测 | 推荐 | "用于检测网络连接状态" |

### 应用签名配置

**文件路径**: `android/app/build.gradle`

```gradle
android {
    signingConfigs {
        release {
            if (System.getenv("ANDROID_KEYSTORE_PATH")) {
                storeFile file(System.getenv("ANDROID_KEYSTORE_PATH"))
                storePassword System.getenv("ANDROID_KEYSTORE_PASSWORD")
                keyAlias System.getenv("ANDROID_KEY_ALIAS")
                keyPassword System.getenv("ANDROID_KEY_PASSWORD")
            } else {
                // 本地签名配置（从key.properties读取）
                def keystoreProperties = new Properties()
                def keystorePropertiesFile = rootProject.file('key.properties')
                if (keystorePropertiesFile.exists()) {
                    keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
                    storeFile file(keystoreProperties['storeFile'])
                    storePassword keystoreProperties['storePassword']
                    keyAlias keystoreProperties['keyAlias']
                    keyPassword keystoreProperties['keyPassword']
                }
            }
        }
    }
}
```

**创建密钥库**（仅需执行一次）：

```bash
keytool -genkey -v -keystore ~/foursquare-release-key.jks -keyalg RSA -keysize 2048 -validity 10000 -alias foursquare
```

**配置文件**: `android/key.properties`（不要提交到Git）

```properties
storePassword=你的密钥库密码
keyPassword=你的密钥密码
keyAlias=foursquare
storeFile=../foursquare-release-key.jks
```

## iOS元数据配置

### 应用基本信息

**文件路径**: `ios/Runner/Info.plist`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <!-- 应用显示名称 -->
    <key>CFBundleDisplayName</key>
    <string>四子游戏</string>
    
    <!-- Bundle标识符 -->
    <key>CFBundleIdentifier</key>
    <string>com.qoder.foursquare</string>
    
    <!-- 应用名称 -->
    <key>CFBundleName</key>
    <string>foursquare</string>
    
    <!-- 版本号 -->
    <key>CFBundleShortVersionString</key>
    <string>1.0.0</string>
    
    <!-- 构建号 -->
    <key>CFBundleVersion</key>
    <string>1</string>
    
    <!-- 最低iOS版本 -->
    <key>MinimumOSVersion</key>
    <string>12.0</string>
    
    <!-- 支持的设备方向 -->
    <key>UISupportedInterfaceOrientations</key>
    <array>
        <string>UIInterfaceOrientationPortrait</string>
        <string>UIInterfaceOrientationLandscapeLeft</string>
        <string>UIInterfaceOrientationLandscapeRight</string>
    </array>
    
    <!-- iPad方向支持 -->
    <key>UISupportedInterfaceOrientations~ipad</key>
    <array>
        <string>UIInterfaceOrientationPortrait</string>
        <string>UIInterfaceOrientationPortraitUpsideDown</string>
        <string>UIInterfaceOrientationLandscapeLeft</string>
        <string>UIInterfaceOrientationLandscapeRight</string>
    </array>
    
    <!-- 状态栏样式 -->
    <key>UIStatusBarStyle</key>
    <string>UIStatusBarStyleLightContent</string>
    
    <!-- 网络权限说明（iOS 14+需要） -->
    <key>NSLocalNetworkUsageDescription</key>
    <string>本应用需要访问本地网络以支持在线对战功能</string>
    
    <!-- 用户追踪说明（iOS 14.5+） -->
    <key>NSUserTrackingUsageDescription</key>
    <string>我们使用匿名数据分析来改进游戏体验</string>
    
    <!-- 其他Flutter配置 -->
    <key>CADisableMinimumFrameDurationOnPhone</key>
    <true/>
    <key>UIApplicationSupportsIndirectInputEvents</key>
    <true/>
</dict>
</plist>
```

### Xcode项目配置

**文件路径**: `ios/Runner.xcodeproj/project.pbxproj`（在Xcode中修改）

1. 打开Xcode项目：
   ```bash
   open ios/Runner.xcworkspace
   ```

2. 在Xcode中配置：
   - **General → Identity**
     - Display Name: 四子游戏
     - Bundle Identifier: com.qoder.foursquare
     - Version: 1.0.0
     - Build: 1
   
   - **General → Deployment Info**
     - Deployment Target: iOS 12.0
     - Devices: iPhone, iPad
   
   - **Signing & Capabilities**
     - Team: 选择你的开发团队
     - Signing Certificate: 选择证书
     - Provisioning Profile: 自动或手动选择

## Web元数据配置

### PWA配置清单

**文件路径**: `web/manifest.json`

```json
{
  "name": "四子游戏 - Four Square Chess",
  "short_name": "四子游戏",
  "description": "经典策略性四子棋游戏，支持人机对战、在线对弈和游戏回放",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#1976D2",
  "theme_color": "#1976D2",
  "orientation": "any",
  "icons": [
    {
      "src": "icons/Icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "icons/Icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "icons/Icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "icons/Icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any"
    }
  ],
  "categories": ["games", "entertainment"],
  "lang": "zh-CN",
  "dir": "ltr"
}
```

### HTML元数据

**文件路径**: `web/index.html`

```html
<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">
  
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="四子游戏是一款策略性棋类游戏，支持人机对战、在线对弈和游戏回放">
  <meta name="keywords" content="四子棋,策略游戏,棋类游戏,AI对战,在线对战">
  <meta name="author" content="Qoder">
  
  <!-- iOS meta tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="四子游戏">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>
  
  <!-- Open Graph meta tags -->
  <meta property="og:title" content="四子游戏 - Four Square Chess">
  <meta property="og:description" content="经典策略性四子棋游戏">
  <meta property="og:image" content="icons/Icon-512.png">
  <meta property="og:type" content="website">
  
  <!-- Twitter Card meta tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="四子游戏">
  <meta name="twitter:description" content="经典策略性四子棋游戏">
  <meta name="twitter:image" content="icons/Icon-512.png">
  
  <title>四子游戏 - 策略对弈，智趣无穷</title>
  <link rel="manifest" href="manifest.json">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- 主题色 -->
  <meta name="theme-color" content="#1976D2">
</head>
<body>
  <!-- 加载指示器 -->
  <div id="loading">
    <style>
      body {
        margin: 0;
        background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
      }
      #loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        flex-direction: column;
      }
      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      .loading-text {
        color: white;
        margin-top: 20px;
        font-family: sans-serif;
      }
    </style>
    <div class="spinner"></div>
    <div class="loading-text">加载中...</div>
  </div>
  
  <script src="flutter.js" defer></script>
</body>
</html>
```

## 版本号管理

### 版本号规范

采用**语义化版本控制** (Semantic Versioning)：`MAJOR.MINOR.PATCH`

- **MAJOR** (主版本号): 不兼容的重大变更
- **MINOR** (次版本号): 向后兼容的功能新增
- **PATCH** (修订号): 向后兼容的问题修复

### 版本历史规划

| 版本 | 说明 | 计划发布时间 |
|------|------|-------------|
| 0.1.0 | 内部开发版本 | 当前 |
| 1.0.0 | 首次正式发布 | 本轮迭代完成后 |
| 1.0.1 | Bug修复版本 | 发布后1-2周 |
| 1.1.0 | 新增功能版本 | 发布后1-2个月 |
| 2.0.0 | 重大更新版本 | 发布后6-12个月 |

### 构建号管理

**Android versionCode**:
- 格式：整数，每次构建递增
- 示例：1, 2, 3, ...
- 用途：Play Store用于判断版本新旧

**iOS Build Number**:
- 格式：整数或字符串
- 推荐格式：YYMMDDNN (年月日+序号)
- 示例：25102201 (2025年10月22日第01次构建)

### 版本更新脚本

创建 `scripts/bump_version.sh`:

```bash
#!/bin/bash
# 版本号升级脚本

VERSION=$1
BUILD_NUMBER=$2

if [ -z "$VERSION" ]; then
    echo "Usage: ./bump_version.sh <version> [build_number]"
    echo "Example: ./bump_version.sh 1.0.1 2"
    exit 1
fi

# 更新pubspec.yaml
sed -i.bak "s/version: .*/version: $VERSION/" pubspec.yaml

# 更新Android
if [ ! -z "$BUILD_NUMBER" ]; then
    sed -i.bak "s/versionCode .*/versionCode $BUILD_NUMBER/" android/app/build.gradle
fi
sed -i.bak "s/versionName .*/versionName \"$VERSION\"/" android/app/build.gradle

# 更新iOS (需要在Xcode中手动更新，或使用agvtool)
echo "iOS版本需要在Xcode中手动更新到: $VERSION"

echo "版本已更新到: $VERSION"
```

## 配置验证

### 验证清单

执行以下步骤验证配置是否正确：

**Android**:
```bash
# 检查配置
grep "applicationId" android/app/build.gradle
grep "versionName" android/app/build.gradle
grep "android:label" android/app/src/main/AndroidManifest.xml

# 构建测试
flutter build apk --debug
flutter install
```

**iOS**:
```bash
# 打开Xcode检查
open ios/Runner.xcworkspace

# 或使用命令行检查
/usr/libexec/PlistBuddy -c "Print CFBundleIdentifier" ios/Runner/Info.plist
/usr/libexec/PlistBuddy -c "Print CFBundleShortVersionString" ios/Runner/Info.plist
```

**Web**:
```bash
# 检查配置
cat web/manifest.json | grep "name"
cat web/index.html | grep "title"

# 构建测试
flutter build web --release
```

### 常见问题

**Q1: 修改包名后应用无法安装？**
- 清理旧版本应用
- 执行 `flutter clean`
- 重新构建

**Q2: iOS显示的应用名称不对？**
- 检查 `CFBundleDisplayName` 而不是 `CFBundleName`
- 清理Derived Data重新构建

**Q3: Web应用主题色不生效？**
- 清理浏览器缓存
- 检查 `manifest.json` 和 `index.html` 中的theme-color一致

## 配置文件模板

为方便配置，项目提供了以下模板文件：

- `templates/AndroidManifest.template.xml` - Android清单模板
- `templates/Info.template.plist` - iOS配置模板
- `templates/manifest.template.json` - Web清单模板

使用模板时，替换其中的占位符：
- `{{APP_NAME}}` → 四子游戏
- `{{PACKAGE_NAME}}` → com.qoder.foursquare
- `{{VERSION}}` → 1.0.0
- `{{BUILD_NUMBER}}` → 1

## 下一步

配置完成元数据后：

1. **生成图标和启动屏**
   ```bash
   flutter pub run flutter_launcher_icons
   flutter pub run flutter_native_splash:create
   ```

2. **测试配置**
   ```bash
   flutter clean
   flutter run
   ```

3. **验证信息**
   - 检查应用名称是否正确
   - 检查应用图标是否显示
   - 检查版本号是否正确

4. **准备应用商店资产**
   - 进入任务1.4

## 参考资源

- [Flutter平台特定代码](https://docs.flutter.dev/platform-integration/platform-channels)
- [Android应用清单](https://developer.android.com/guide/topics/manifest/manifest-intro)
- [iOS Info.plist](https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/)
- [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)
- [语义化版本](https://semver.org/)

---

**文档版本**: 1.0  
**最后更新**: 2025-10-22  
**维护者**: Qoder AI
