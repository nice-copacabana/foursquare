# Foursquare 项目全方位深度报告

## 1. 执行摘要
**项目名称**: Foursquare (四子游戏)
**当前版本**: 0.1.0 (发布于 2025-10-22)
**项目状态**: 活跃开发中 - 第一阶段（基础）已完成，第二阶段（AI）已完成，正准备进入第三阶段（语音/创新）。
**核心价值主张**: 一款跨平台的策略棋类游戏，融合了经典玩法与现代技术特性（AI、语音控制、Wear OS 支持）。

## 2. 业务与产品概览

### 2.1. 产品愿景
打造一款高端、易用且极具创新性的棋类游戏体验，能够无缝运行于智能手机、平板和小稌序平台上，并特别关注包容性（语音控制/冥想模式）。

### 2.2. 目标受众
-   **休闲玩家**: 适合碎片化时间的快速 4x4 对局。
-   **策略爱好者**: 提供不同难度的 Minimax AI 挑战。
-   **移动设备用户**: 支持Android、iOS等主流移动平台。
-   **小程序用户**: 计划支持微信、支付宝等小程序平台。
-   **视障人士 / 关注无障碍体验的用户**: 创新的"冥想模式"允许通过语音进行无屏幕游戏。

### 2.3. 核心特性
-   **当前功能 (v0.1.0)**:
    -   PvP (本地双人) & PvE (AI 人机对战，3种难度)。
    -   完整的游戏循环 (移动、吃子、胜负判定)。
    -   统计与历史记录追踪。
    -   保存/加载功能。
    -   包含动画和音效的精美 UI。
-   **即将推出 (v0.2.0 及后续)**:
    -   **游戏回放**: 逐步回顾历史记录 (计划于 v0.2.0 发布)。
    -   **语音控制**: "语音落子"机制（手机端）。
    -   **冥想模式**: 无屏幕纯音频游戏体验。
    -   **小程序平台**: 支持微信、支付宝等平台。

## 3. 项目管理与进度

### 3.1. 开发时间线
-   **第一阶段: 基础架构 (已于 2025年10月 完成)**
    -   第1周: 数据模型, 游戏引擎, 基础 UI, 服务 (音频/存储)。
    -   第2周: 游戏逻辑, 状态管理, 动画实现。
    -   第3周: 体验优化, 打磨。
-   **第二阶段: AI 系统 (已完成)**
    -   实现了带 Alpha-Beta 剪枝的 Minimax 算法。
    -   3个难度级别 (简单/中等/困难)。
-   **第三阶段: 创新功能 (即将开始 - 预估 32 小时)**
    -   重点: 语音控制 & 冥想模式。
    -   技术: 语音转文字 (STT), 文字转语音 (TTS)。
-   **第四阶段: Wear OS 适配 (已搁置 - 原预估 40 小时)**
    -   **搁置原因**: 智能手表平台技术碎片化严重，iOS Watch仅支持Apple Watch、Android Wear OS支持有限、国产品牌多使用独立系统（小米Vela、华为HarmonyOS等），逐个适配需投入大量资源。
    -   **调整策略**: 将资源重新分配至语音控制(+16h)、小程序适配(+16h)、在线对战预研(+8h)。
    -   **代码保留**: 已完成的Wear OS基础代码保留，待主线功能稳定后再评估重启。

### 3.2. 当前状态 (截至 2025年11月)
-   **总体进度**: 约完成 40-50% (核心游戏 & AI 已完成)。
-   **近期成就**:
    -   v0.1.0 版本发布。
    -   Wear OS AndroidManifest 配置完成。
    -   语音/冥想功能规划完成。
-   **下一步行动**:
    -   实现游戎回放系统 (v0.2.0)。
    -   开始语音控制集成。
    -   小程序平台适配研究。

## 4. 技术架构

### 4.1. 技术栈
-   **框架**: Flutter (SDK >=3.0.0 <4.0.0)
-   **语言**: Dart (SDK >=3.0.0)
-   **架构**: BLoC (业务逻辑组件) 模式。
-   **关键库**:
    -   `flutter_bloc`: 状态管理。
    -   `hive`: 本地 NoSQL 数据库 (持久化)。
    -   `audioplayers`: 音频引擎。
    -   `equatable`: 值相等性比较。

### 4.2. 系统设计
-   **分层架构**:
    -   **UI 层**: `GamePage`, `AnimatedBoardWidget` (视图)。
    -   **BLoC 层**: `GameBloc` (视图模型/控制器) - 连接 UI 和 逻辑。
    -   **引擎层**: `GameEngine`, `MoveValidator` (纯逻辑领域)。
    -   **数据层**: `BoardState`, `GameSave` (模型)。
-   **AI 子系统**:
    -   目前在主 isolate 运行，通过 Alpha-Beta 剪枝和置换表 (Transposition Tables) 进行优化。
    -   根据游戏阶段动态调整搜索深度。

### 4.3. 代码质量
-   **测试**: 核心逻辑覆盖率高 (约 95%)。
-   **文档**: 详尽的内部文档 (中文) 和架构指南。
-   **模块化**: 关注点分离清晰，便于添加新前端 (如 Wear OS) 而不改变核心逻辑。

## 5. 风险评估
-   **语音识别准确率**: 依赖于平台能力和环境噪音。
-   **AI 性能**: JS/Web 导出版本的 AI 计算性能可能与原生版本存在差异。
-   **小程序平台适配**: 不同小程序平台API差异可能需要额外适配工作。

## 6. 建议
1.  **优先开发回放系统**: 按 v0.2.0 计划进行，这能为玩家增加显著的学习价值。
2.  **语音 UX 测试**: 尽早制作语音指令原型，确保"坐标系统" (例如 "A2", "横1竖2") 符合直觉。
3.  **小程序平台选型**: 优先评估微信小程序平台，验证Flutter转小程序的技术方案。
